<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <style>
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      padding: 18px;
      background: #fafafa;
      color: #333;
      margin: 0;
    }
    .resumen-container {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 16px;
      font-size: 14px;
      line-height: 1.6;
      max-height: 240px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .button-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 12px 24px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      flex: 1;
      min-width: 120px;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    #btnCopiar {
      background: #34A853;
      color: white;
    }
    #btnCopiar:hover:not(:disabled) {
      background: #2d9248;
    }
    #btnCerrar {
      background: #666;
      color: white;
    }
    #btnCerrar:hover:not(:disabled) {
      background: #555;
    }
    #status {
      margin-top: 12px;
      padding: 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      display: none;
    }
    #status.success {
      background: #d4edda;
      color: #155724;
      display: block;
    }
    #status.error {
      background: #f8d7da;
      color: #721c24;
      display: block;
    }
  </style>
</head>
<body>
  <div class="resumen-container" id="resumen"><?= resumen ?></div>
  
  <div class="button-container">
    <button id="btnCopiar">üìã Copiar al Portapapeles</button>
    <button id="btnCerrar">‚úñÔ∏è Cerrar</button>
  </div>
  
  <div id="status"></div>

  <script>
    console.log("Di√°logo de resumen cargado");
    
    document.getElementById("btnCopiar").onclick = function() {
      console.log("Click en Copiar");
      copiarAlPortapapeles();
    };
    
    document.getElementById("btnCerrar").onclick = function() {
      console.log("Click en Cerrar");
      google.script.host.close();
    };
    
    function copiarAlPortapapeles() {
      var status = document.getElementById("status");
      
      try {
        var resumenText = document.getElementById("resumen").innerText;
        var textarea = document.createElement("textarea");
        textarea.value = resumenText;
        textarea.style.position = "fixed";
        textarea.style.opacity = "0";
        document.body.appendChild(textarea);
        textarea.select();
        
        var exitoso = document.execCommand("copy");
        document.body.removeChild(textarea);
        
        if (exitoso) {
          console.log("Texto copiado exitosamente");
          status.className = "success";
          status.textContent = "‚úÖ Copiado al portapapeles";
          
          // Cerrar autom√°ticamente despu√©s de 1.5 segundos
          setTimeout(function() {
            google.script.host.close();
          }, 1500);
        } else {
          throw new Error("execCommand retorn√≥ false");
        }
      } catch(e) {
        console.error("Error al copiar:", e);
        status.className = "error";
        status.textContent = "‚ùå Error al copiar. Intenta seleccionar y copiar manualmente (Ctrl+C)";
      }
    }
  </script>
</body>
</html>
